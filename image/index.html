<!DOCTYPE html>
<html>
<head>
    <title>Bird Image Classifier</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
</head>
<body>

<h2>Ralph's Bird Classifier:</h2>

Image to analyze:
<input type='file' accept='image/*' onchange='openFile(event)' />
<br /><br />
<img id='sourceImage' style="height:200px; width:200px;" />

<textarea id="responseTextArea" class="UIInput" style="width:400px; height:200px;"></textarea>
<br />

<script type="text/javascript">

    var openFile = function(file) {
        var input = file.target;

        var reader = new FileReader();
        reader.onload = function(){
            var dataURL = reader.result;

            var params = {
                // Request parameters
                "application": "myTestApp"
            };

            var parts = dataURL.split(';base64,');
            var contentType = parts[0].split(':')[1];
            var raw = window.atob(parts[1]);
            var rawLength = raw.length;

            var uInt8Array = new Uint8Array(rawLength);

            for (var i = 0; i < rawLength; ++i) {
                uInt8Array[i] = raw.charCodeAt(i);
            }

            var imgContent = new Blob([uInt8Array], { type: contentType });

            const something = new Image();          // creates an <img> element
            something.src = reader.result;          // loads the data URL as the image source
            document.querySelector("#sourceImage").src = something.src
            
            $.ajax({
                url: "https://tippcv-training.cognitiveservices.azure.com/customvision/v3.0/Prediction/f6f62566-f003-40c6-bbf9-e66c97347d75/classify/iterations/Iteration3/image?" + $.param(params),
                beforeSend: function(xhrObj){
                    // Request headers
                    xhrObj.setRequestHeader("Prediction-Key","1f7e5cbbb079455aa350177595c2a4b0");
                    xhrObj.setRequestHeader("Content-Type","application/octet-stream");
                },
                type: "POST",
                // Request body
                data: imgContent,
            })
            .done(function(data) {
                // Show formatted JSON on webpage.
                $("#responseTextArea").val(JSON.stringify(data, null, 2));
            })
            .fail(function() {
                alert("error");
            });
        };

        reader.readAsDataURL(input.files[0]);
    };
</script>

</body>
</html>
